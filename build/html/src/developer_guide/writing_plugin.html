<!-- Based on https://stackoverflow.com/a/25543713/1130282 -->

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Plugins &amp; Macros &#8212; mitsuba2 0.1.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Testing" href="testing.html" />
    <link rel="prev" title="Variants in C++" href="variants_cpp.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="testing.html" title="Testing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="variants_cpp.html" title="Variants in C++"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mitsuba2 0.1.dev0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Plugins &amp; Macros</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../index.html" class="text-logo">Mitsuba 2</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/intro.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/cloning.html">Cloning the repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/variants.html">选择变体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/compiling.html">Compiling the system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/file_format.html">Scene file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/differences.html">Differences to Mitsuba 0.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Python interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_interface/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_interface/parsing_xml.html">Parsing XML code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_interface/rendering_scene.html">Rendering a scene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_interface/bsdf_eval.html">Custom applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Inverse rendering</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../inverse_rendering/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverse_rendering/diff_render.html">Differentiable rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverse_rendering/advanced.html">More advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inverse_rendering/pytorch.html">Integration with PyTorch</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="variants_cpp.html">Variants in C++</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Plugins &amp; Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_documentation.html">Building the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="polarization.html">Polarization</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced_topics/custom_plugins.html">Custom plugins in Python</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugin reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugin_reference/intro.html">Plugin reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html">Shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#bsdfs">BSDFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#phase-functions">Phase functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#emitters">Emitters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#sensors">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#textures">Textures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#spectra">Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#integrators">Integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#samplers">Samplers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#films">Films</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/plugins.html#reconstruction-filters">Reconstruction filters</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/core_api.html">Core API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/render_api.html">Render API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/python_api.html">Python API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../zz_bibliography.html">Bibliography</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../index.html">Docs</a></li>
              
              <li>Plugins &amp; Macros</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="plugins-macros">
<h1>Plugins &amp; Macros<a class="headerlink" href="#plugins-macros" title="Permalink to this headline">¶</a></h1>
<p>该章节简明的回顾了基本插件定义时的框架，以阐明各种 <a href="#id1"><span class="problematic" id="id2">``</span></a>MTS_* `` 宏的作用，比如有些宏负责导入类型、
实例化变量和提供运行时类型的信息。</p>
<div class="section" id="example-code">
<h2>Example code<a class="headerlink" href="#example-code" title="Permalink to this headline">¶</a></h2>
<p>考虑以下假设的插件 <code class="docutils literal notranslate"><span class="pre">MyPlugin</span></code>：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NAMESPACE_BEGIN</span><span class="p">(</span><span class="n">mitsuba</span><span class="p">)</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Float</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Spectrum</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">MyPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">PluginInterface</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">MTS_IMPORT_BASE</span><span class="p">(</span><span class="n">PluginInterface</span><span class="p">,</span> <span class="n">m_some_member</span><span class="p">,</span> <span class="n">some_method</span><span class="p">)</span>
    <span class="n">MTS_IMPORT_TYPES</span><span class="p">()</span>

    <span class="n">MyPlugin</span><span class="p">();</span>

    <span class="n">Spectrum</span> <span class="nf">foo</span><span class="p">(...,</span> <span class="n">Mask</span> <span class="n">active</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">MTS_MASKED_FUNCTION</span><span class="p">(</span><span class="n">ProfilerPhase</span><span class="o">::</span><span class="n">MyEval</span><span class="p">,</span> <span class="n">active</span><span class="p">)</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">/// Declare RTTI data structures</span>
    <span class="n">MTS_DECLARE_CLASS</span><span class="p">()</span>
<span class="k">protected</span><span class="o">:</span>
    <span class="c1">/// Important: declare a protected virtual destructor</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">MyPlugin</span><span class="p">();</span>

<span class="p">};</span>

<span class="c1">/// Implement RTTI data structures</span>
<span class="n">MTS_IMPLEMENT_CLASS_VARIANT</span><span class="p">(</span><span class="n">MyPlugin</span><span class="p">,</span> <span class="n">PluginInterface</span><span class="p">)</span>
<span class="n">MTS_EXPORT_PLUGIN</span><span class="p">(</span><span class="n">MyPlugin</span><span class="p">,</span> <span class="s">&quot;Description of my plugin&quot;</span><span class="p">)</span>
<span class="n">NAMESPACE_END</span><span class="p">(</span><span class="n">mitsuba</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="macros">
<h2>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h2>
<p>需要注意的是，接下来所列出来的宏并非都出现在了上面的示例代码中。</p>
<div class="section" id="mts-mask-argument-mask">
<h3><span class="monosp">MTS_MASK_ARGUMENT(mask)</span><a class="headerlink" href="#mts-mask-argument-mask" title="Permalink to this headline">¶</a></h3>
<p>这个宏通常出现在以掩码为参数的函数开头。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">my_method</span><span class="p">(...,</span> <span class="n">Mask</span> <span class="n">active</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">MTS_MASK_ARGUMENT</span><span class="p">(</span><span class="n">active</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>scalar 变体实际上不需要掩码：如果一个函数被调用了，那么我们假设其 <code class="docutils literal notranslate"><span class="pre">active=true</span></code> 。不幸的是，
掩码在此例中可能会因为额外分支的产生而降低性能。因此，<code class="docutils literal notranslate"><span class="pre">MTS_MASK_ARGUMENT</span></code> 扩展为：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">is_scalar_v</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</pre></div>
</div>
<p>它将掩码参数转换为 scalar 目标上的编译时常量，从而允许编译器优化掉不需要的分支。<code class="docutils literal notranslate"><span class="pre">MTS_MASK_ARGUMENT</span></code> 掩码
参数也是下一个宏中的一部分。</p>
</div>
</div>
<div class="section" id="mts-masked-function-phase-mask">
<h2><span class="monosp">MTS_MASKED_FUNCTION(phase, mask)</span><a class="headerlink" href="#mts-masked-function-phase-mask" title="Permalink to this headline">¶</a></h2>
<p>这个宏是建立在 <code class="docutils literal notranslate"><span class="pre">MTS_MASK_ARGUMENT</span></code> 宏基础上的，通常出现在以掩码为参数的函数开头。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">my_method</span><span class="p">(...,</span> <span class="n">Mask</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">MTS_MASKED_FUNCTION</span><span class="p">(</span><span class="n">ProfilerPhase</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">,</span> <span class="n">active</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>scalar 变体实际上不需要掩码：如果一个函数被调用了，那么我们假设其 <code class="docutils literal notranslate"><span class="pre">active=true</span></code> 。不幸的是，
掩码在此例中可能会因为额外分支的产生而降低性能。因此，<code class="docutils literal notranslate"><span class="pre">MTS_MASKED_FUNCTION</span></code> 扩展为：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">is_scalar_v</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">ScopedPhase</span> <span class="nf">_</span><span class="p">(</span><span class="n">ProfilerPhase</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">);</span>
</pre></div>
</div>
<p>它将掩码参数转换为 scalar 目标上的编译时常量，从而允许编译器优化掉不需要的分支。</p>
<p>Mitsuba 带有一个强大的采样侦查器以帮助追踪渲染过程中的热点区域。这个宏的最后一行（<code class="docutils literal notranslate"><span class="pre">ScopedPhase</span></code>）通知了该侦查器，
我们当前正在执行一个属于侦查器阶段 <code class="docutils literal notranslate"><span class="pre">phase</span></code> 的函数。</p>
</div>
<div class="section" id="mts-import-base-name">
<h2><span class="monosp">MTS_IMPORT_BASE(Name, …)</span><a class="headerlink" href="#mts-import-base-name" title="Permalink to this headline">¶</a></h2>
<p>因为大多数 Mitsuba 的类都是模版，所以父类的属性和方法在默认情况下是不可见的。它们可以通过 <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Base::some_method;</span></code> 语
句显式导入，但是重复编写很多这样的语句是很麻烦的。使用可变宏 <code class="docutils literal notranslate"><span class="pre">MTS_IMPORT_BASE</span></code> 可以扩展为任意多这种 <code class="docutils literal notranslate"><span class="pre">using</span></code> 语句。例如：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MTS_IMPORT_BASE</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">m_some_member</span><span class="p">,</span> <span class="n">some_method</span><span class="p">)</span>
</pre></div>
</div>
<p>相当于扩展为：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Base</span> <span class="o">=</span> <span class="n">Name</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">m_some_member</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">some_method</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="mts-import-core-types">
<span id="macro-import-core-types"></span><h2><span class="monosp">MTS_IMPORT_CORE_TYPES()</span><a class="headerlink" href="#mts-import-core-types" title="Permalink to this headline">¶</a></h2>
<p>该宏将生成一系列用于导入 Mitsuba 核心库的 <code class="docutils literal notranslate"><span class="pre">using</span></code> 声明（例如，<code class="docutils literal notranslate"><span class="pre">Vector{1/2/3}{i/u/f/d}</span></code>，<code class="docutils literal notranslate"><span class="pre">Point{1/2/3}{i/u/f/d}</span></code> 等）。
它们是从 <code class="docutils literal notranslate"><span class="pre">Float</span></code> 定义中自动推断出来的。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在计算此宏之前，必须存在一个名叫 <code class="docutils literal notranslate"><span class="pre">Float</span></code> 的参数。</p>
</div>
<p>例如：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Float</span> <span class="o">=</span> <span class="kt">float</span><span class="p">;</span>

<span class="n">MTS_IMPORT_CORE_TYPES</span><span class="p">()</span>

<span class="c1">// expands to:</span>

<span class="c1">// ...</span>
<span class="k">using</span> <span class="n">Point2f</span> <span class="o">=</span> <span class="n">Point</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Point3f</span> <span class="o">=</span> <span class="n">Point</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">using</span> <span class="n">BoundingBox3f</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="o">&lt;</span><span class="n">Point3f</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">// ...</span>
</pre></div>
</div>
</div>
<div class="section" id="mts-import-types">
<span id="macro-import-types"></span><h2><span class="monosp">MTS_IMPORT_TYPES(…)</span><a class="headerlink" href="#mts-import-types" title="Permalink to this headline">¶</a></h2>
<p>该宏调用 <code class="docutils literal notranslate"><span class="pre">MTS_IMPORT_CORE_TYPES()</span></code> ，并进一步导入如  <code class="docutils literal notranslate"><span class="pre">Ray3f</span></code>， <code class="docutils literal notranslate"><span class="pre">SurfaceInteraction3f</span></code>， <code class="docutils literal notranslate"><span class="pre">BSDF</span></code> 等渲染相关类型。
这些模版的别名依赖于之前声明的 <code class="docutils literal notranslate"><span class="pre">Float</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Spectrum</span></code>。</p>
<p>还可以将其他类型作为参数进行传递给那些创建的模版别名。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Float</span>    <span class="o">=</span> <span class="kt">float</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Spectrum</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="mi">4</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">MTS_IMPORT_TYPES</span><span class="p">(</span><span class="n">MyType1</span><span class="p">,</span> <span class="n">MyType2</span><span class="p">)</span>

<span class="c1">// expands to:</span>

<span class="n">MTS_IMPORT_CORE_TYPES</span><span class="p">()</span>
<span class="c1">// ...</span>
<span class="k">using</span> <span class="n">Ray3f</span> <span class="o">=</span> <span class="n">Ray</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">using</span> <span class="n">SurfaceInteraction3f</span> <span class="o">=</span> <span class="n">SurfaceInteraction</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">using</span> <span class="n">MyType1</span> <span class="o">=</span> <span class="n">MyType1</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// alias for the optional parameters</span>
<span class="k">using</span> <span class="n">MyType2</span> <span class="o">=</span> <span class="n">MyType2</span><span class="o">&lt;</span><span class="n">Float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="mts-declare-class">
<h2><span class="monosp">MTS_DECLARE_CLASS()</span><a class="headerlink" href="#mts-declare-class" title="Permalink to this headline">¶</a></h2>
<p>这个宏应该在插件的 <span class="monosp">class</span> 声明中进行调用。 它将声明 RTTI（运行时类型信息）的数据结构，这些
数据结构对于下列操作非常有用：</p>
<ul class="simple">
<li><p>检查对象是否派生自某个 <span class="monosp">class</span></p></li>
<li><p>在运行时确定 <span class="monosp">class</span> 的父类</p></li>
<li><p>通过名称实例化一个 <span class="monosp">class</span></p></li>
<li><p>从二进制数据流中取消序列化一个 <span class="monosp">class</span></p></li>
</ul>
</div>
<div class="section" id="mts-implement-class-variant-name-parent">
<h2><span class="monosp">MTS_IMPLEMENT_CLASS_VARIANT(Name, Parent)</span><a class="headerlink" href="#mts-implement-class-variant-name-parent" title="Permalink to this headline">¶</a></h2>
<p>应该在自定义插件类的 <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> 文件底部调用此宏。它的作用是为该插件初始化 RTTI 数据结构，之前这些数据
结构是使用 <code class="docutils literal notranslate"><span class="pre">MTS_DECLARE_CLASS()</span></code> 声明的。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Name</span></code> 参数应该是插件的 <span class="monosp">class</span> 名。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Parent</span></code> 参数应该取插件接口的 <span class="monosp">class</span> 名。</p></li>
</ul>
</div>
<div class="section" id="mts-export-plugin-name-descr">
<h2><span class="monosp">MTS_EXPORT_PLUGIN(Name, Descr)</span><a class="headerlink" href="#mts-export-plugin-name-descr" title="Permalink to this headline">¶</a></h2>
<p>此宏将显式实例化插件启用的所有变体：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MTS_EXPORT_PLUGIN</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;My fancy plugin&quot;</span><span class="p">)</span>

<span class="c1">// expands to:</span>

<span class="k">template</span> <span class="k">class</span> <span class="nc">MTS_EXPORT</span> <span class="n">Name</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">Color</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;&gt;</span>    <span class="c1">// scalar_mono</span>
<span class="k">template</span> <span class="k">class</span> <span class="nc">MTS_EXPORT</span> <span class="n">Name</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">Spectrum</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="mi">4</span><span class="o">&gt;&gt;</span> <span class="c1">// scalar_spectral</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>它还将可读性的 <code class="docutils literal notranslate"><span class="pre">Descr</span></code> 描述和 Mitsuba 图形用户界面将来可能使用的插件关联了起来。</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="variants_cpp.html" title="previous chapter (use the left arrow)">Variants in C++</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="testing.html" title="next chapter (use the right arrow)">Testing</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="testing.html" title="Testing"
             >next</a> |</li>
        <li class="right" >
          <a href="variants_cpp.html" title="Variants in C++"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mitsuba2 0.1.dev0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Plugins &amp; Macros</a></li> 
      </ul>
    </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>